<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Telegram Auth</title>
</head>
<body>
<script>
(function () {
  try {
    // Telegram 新版：数据在 hash 里
    const hash = window.location.hash;

    if (!hash.startsWith('#tgAuthResult=')) {
      console.error('No tgAuthResult in hash');
      return;
    }

    const encoded = hash.substring('#tgAuthResult='.length);

    // ⚠️ 注意：这里不 decode，让 Flutter 去处理
    const data = {
      tgAuthResult: encoded
    };

    console.log('Telegram auth data:', data);

    if (window.opener) {
      window.opener.postMessage(data, '*');
    }

    setTimeout(() => window.close(), 300);
  } catch (e) {
    console.error('Telegram redirect error:', e);
  }
})();
</script>

<p>Telegram 授权处理中，请稍候…</p>
</body>
</html>
